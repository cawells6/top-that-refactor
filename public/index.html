<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Top That! Card Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Your CSS -->
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="/styles/modals.css" />
    <!-- Header button styles are now in style.css -->

    <!-- Entry‑point for your client modules -->
    <script type="module" src="/scripts/main.ts"></script>
  </head>
  <body class="body-loading" style="min-height: 100vh; display: flex; flex-direction: column">
    <!-- Header removed per user request -->

    <!-- <div class="notice notice--hidden" id="notice-banner"></div> -->
    <!-- <div class="notice notice--hidden" id="error-banner"></div> -->
    <div class="modal__overlay modal__overlay--hidden" id="modal-overlay"></div>

    <main class="main-content" id="main-content">
      <!-- Lobby Screen -->
      <div class="lobby" id="lobby-container">
        <div id="lobby-outer-card" class="lobby-modal-container">
          <div id="lobby-inner-content" class="game-setup-content">
            <div class="setup-header">
              <!-- Logo using logo and slogan.svg -->
              <div class="header-logo">
                <img 
                  src="/assets/logo and slogan.svg?v=2024" 
                  alt="Top That! Logo and Slogan" 
                  onload="console.log('Logo loaded successfully:', this.src);"
                  onerror="console.error('Logo failed to load:', this.src);" />
              </div>
            </div>
            
            <form id="lobby-form" autocomplete="off">
              <!-- Player Name Input -->
              <div class="name-input-section">
                <input type="text" id="player-name-input" placeholder="Who's playing today?" maxlength="20" required />
              </div>
              

              
              <div class="player-selection">
                <!-- Human Players Section -->
                <div class="player-section">
                  <h3 class="section-title">Users</h3>
                  <div class="player-counter">
                    <button type="button" class="counter-btn" id="humans-minus" data-target="total-players-input">−</button>
                    <input type="number" id="total-players-input" min="1" max="4" value="1" readonly />
                    <button type="button" class="counter-btn" id="humans-plus" data-target="total-players-input">+</button>
                  </div>
                  <!-- Dynamic Human Player Silhouettes -->
                  <div class="player-silhouettes" id="human-silhouettes">
                    <!-- Silhouettes will be dynamically added/removed here -->
                  </div>
                </div>

                <!-- Bots Players Section -->
                <div class="player-section">
                  <h3 class="section-title">Bots</h3>
                  <div class="player-counter">
                    <button type="button" class="counter-btn" id="cpus-minus" data-target="cpu-players-input">−</button>
                    <input type="number" id="cpu-players-input" min="0" value="0" readonly />
                    <button type="button" class="counter-btn" id="cpus-plus" data-target="cpu-players-input">+</button>
                  </div>
                  <!-- Dynamic Bots Player Silhouettes -->
                  <div class="player-silhouettes" id="cpu-silhouettes">
                    <!-- Silhouettes will be dynamically added/removed here -->
                  </div>
                </div>
              </div>

              <!-- Single lobby validation message area - always reserves space -->
              <div id="lobby-validation-message" style="display: flex; justify-content: center; margin: 1rem 0;">
                <div class="message-box-content" style="padding: 1rem; border: 2px solid transparent; border-radius: 0.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); width: 280px; text-align: center; background-color: #f8d7da;">
                  <p style="margin: 0; font-weight: 700; font-size: 1.1rem; line-height: 1.2; color: #721c24;"></p>
                </div>
              </div>

              <!-- Move Rules and Deal buttons to bottom with reduced spacing -->
              <div class="lobby-buttons-row">
                <button id="setup-rules-button" class="header-btn" type="button">RULES</button>
                <button id="setup-deal-button" class="header-btn" type="button">LET'S PLAY</button>
              </div>
            </form>
          </div>
        </div>
        <div id="waiting-state" class="hidden" style="width: 100%; text-align: center;">
          <h3 id="waiting-heading">Waiting for players...</h3>
        </div>
      </div>

      <!-- Game Table -->
      <div id="game-table" class="hidden" style="width: 100%; height: 100%;">
        <div class="table" style="width: 100%; height: 100%;">
          <div class="table-slot-top" id="opponent-area-top"></div>
          <div class="table-slot-left" id="opponent-area-left"></div>
          <div class="table-center" id="center-area"></div>
          <div class="table-slot-right" id="opponent-area-right"></div>
          <div class="table-slot-bottom" id="player-area-bottom"></div>
        </div>
      </div>
    </main>

    <section class="game-log game-log--hidden" id="game-log"></section>

    <div
      class="modal modal--hidden"
      id="rules-modal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="rules-modal-title"
    >
      <div class="lobby-modal-container">
        <div class="game-setup-content rules-modal-content">
          <button class="modal__close-button" aria-label="Close">&times;</button>
          <div class="rules-container">
            <h2 class="rules-title">Game Rules</h2>
            <div class="button-container">
              <button
                id="expand-collapse-all-btn"
                class="btn expand-btn"
              >
                Expand All
              </button>
            </div>
          <details class="rules-section">
            <summary class="rules-summary"><h3>1. Getting Started (Game Setup)</h3></summary>
            <div class="rules-details-content">
              <ul>
                <li>
                  <strong>Players & Decks:</strong>
                  <ul>
                    <li>1-4 Players: Use 1 standard deck of 52 cards.</li>
                    <li>5-8 Players: Use 2 standard decks of 52 cards (Note: Current game supports 2-4 players).</li>
                  </ul>
                </li>
                <li>
                  <strong>Dealing the Cards (9 per player):</strong>
                  <ul>
                    <li>
                      <strong>Three Face-Down Cards:</strong> Place 3 cards per player in a row, face-down. <em>Do not look at these.</em>
                    </li>
                    <li>
                      <strong>Three Face-Up Cards:</strong> Place 3 cards per player face-up, directly on top of their face-down cards.
                    </li>
                    <li>
                      <strong>Three Hand Cards:</strong> Deal 3 cards to each player for their starting hand.
                    </li>
                  </ul>
                </li>
                <li>
                  <strong>The Draw Pile:</strong> Place remaining cards face-down in the center.
                </li>
                <li>
                  <strong>The Discard Pile:</strong> Flip the top card of the Draw Pile face-up next to it to start.
                </li>
              </ul>
            </div>
          </details>
          <details class="rules-section">
            <summary class="rules-summary"><h3>2. How to Play Your Turn</h3></summary>
            <div class="rules-details-content">
              <ul>
                <li>
                  <strong>Playing from Your Hand:</strong> You can play one card, or multiple cards <em>of the same value</em> (e.g., two 8s, three Kings). The card(s) played must normally be <strong>higher</strong> than the current top card of the Discard Pile. <em>Example:</em> If a 7 is on top, you can play an 8, a Jack, or multiple 9s. See "Special Cards" and "Four of a Kind" for exceptions.
                </li>
                <li>
                  <strong>Draw Back Up:</strong> If you played from your hand and have fewer than 3 cards, draw from the Draw Pile until you have 3 cards again (if cards remain in Draw Pile).
                </li>
                <li>
                  <strong>Can't Play? Pick Up!</strong> If you cannot make a legal play (higher card or special card), you must pick up the <strong>entire Discard Pile</strong>. These cards are added to your hand. This ends your turn.
                </li>
                <li><strong>Turn Ends:</strong> After playing and drawing (if applicable), or after picking up the Discard Pile.</li>
              </ul>
            </div>
          </details>
          <details class="rules-section">
            <summary class="rules-summary"><h3>3. Special Cards & Their Powers!</h3></summary>
            <div class="rules-details-content">
              <ul>
                <li>
                  <strong class="special-card">2 (Reset Card)</strong>
                  <img src="src/shared/Reset-icon.png" alt="Reset" class="rules-icon" style="vertical-align: middle; width: 1.5em; height: 1.5em; margin-left: 8px" />
                  Can be played on <strong>any card</strong>. <strong>Resets</strong> the Discard Pile (clears it). The next player starts a new Discard Pile with any card.
                </li>
                <li>
                  <strong class="special-card">5 (Copy Card)</strong>
                  <img src="src/shared/Copy-icon.png" alt="Copy" class="rules-icon" style="vertical-align: middle; width: 1.5em; height: 1.5em; margin-left: 8px" />
                  <strong>Copies the value</strong> of the card directly underneath it on the Discard Pile. <em>Example:</em> If a Jack is showing, playing a 5 makes it act like a Jack. The next player must beat a Jack. If played on an empty/reset Discard Pile, it's just a 5.
                </li>
                <li>
                  <strong class="special-card">10 (Burn Card)</strong>
                  <img src="src/shared/Burn-icon.png" alt="Burn" class="rules-icon" style="vertical-align: middle; width: 1.5em; height: 1.5em; margin-left: 8px" />
                  Can be played on <strong>any card</strong>. The <strong>entire Discard Pile is "burned"</strong> (removed from the game). The player who burned the pile plays again to start a new Discard Pile. If they have no cards, the next player starts.
                </li>
                <li>
                  <strong class="special-card">Four of a Kind (Burn & Play Again)</strong>
                  <img src="src/shared/4ofakind-icon.png" alt="Four-of-a-kind" class="rules-icon" style="vertical-align: middle; width: 1.5em; height: 1.5em; margin-left: 8px" />
                  Playing four cards of the same value at once (e.g., four 7s) also <strong>burns the Discard Pile</strong>. Can be played even if its value is <strong>not higher</strong> than the top card. The Discard Pile (including the four-of-a-kind) is removed from the game. The player who burned the pile plays again to start a new Discard Pile. If they have no cards, the next player starts.
                </li>
              </ul>
            </div>
          </details>
          <details class="rules-section">
            <summary class="rules-summary"><h3>4. Playing Your Face-Up & Face-Down Cards</h3></summary>
            <div class="rules-details-content">
              <ul>
                <li>Move to these cards only when your <strong>hand is empty</strong> AND the <strong>Draw Pile is empty</strong>.</li>
                <li>
                  <strong>Playing Face-Up Cards:</strong> Play one face-up card per turn. It must be a legal play. <strong>If you can't play any face-up card:</strong> Choose one face-up card to add to your hand, then pick up the <strong>entire Discard Pile</strong>. Play from your hand on subsequent turns until it's empty again.
                </li>
                <li>
                  <strong>Playing Face-Down Cards (Final Stage!):</strong> Play these when your hand AND all face-up cards are gone. Choose <strong>one</strong> face-down card per turn <em>without looking at it first</em>. Flip it over. <strong>If it's a legal play:</strong> Played on the Discard Pile. <strong>If it's not a legal play:</strong> Add the revealed card to your hand AND pick up the <strong>entire Discard Pile</strong>. Play from your hand until empty again.
                </li>
              </ul>
            </div>
          </details>
          <details class="rules-section">
            <summary class="rules-summary"><h3>5. Winning the Game!</h3></summary>
            <div class="rules-details-content">
              <ul>
                <li>The first player to successfully play all of their cards (Hand, then Face-Up, then Face-Down) is the <strong>WINNER!</strong></li>
              </ul>
            </div>
          </details>
          <details class="rules-section" id="quick-tips-section">
            <summary class="rules-summary"><h3>6. Quick Tips for New Players</h3></summary>
            <div class="rules-details-content">
              <ul>
                <li><strong>Play Higher:</strong> Generally, play a card higher than the Discard Pile's top card.</li>
                <li><strong>Special Cards are Key:</strong> Use 2s, 5s, 10s, and Four-of-a-Kind strategically.</li>
                <li><strong>Can't Play? Pick Up:</strong> If you can't make a legal play, pick up the Discard Pile.</li>
                <li><strong>Card Order:</strong> Hand &rarr; Face-Up &rarr; Face-Down.</li>
                <li><strong>Empty Hand & Draw Pile:</strong> You only move to face-up/face-down cards when your hand AND the draw pile are empty.</li>
              </ul>
            </div>
          </details>
          <button
            class="btn rules-gotit-btn"
            id="rules-gotit-btn"
          >
            Got it!
          </button>
        </div>
      </div>
    </div>
  </div>

    <div class="toast-container" id="toast-container"></div>
  </body>
</html>
