<!doctype html>
<html lang="en" class="loading preload">
  <head>
    <meta charset="UTF-8" />
    <title>Top That! Card Game</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"
    />

    <link rel="stylesheet" href="/styles/immediate-fix.css" />

    <link
      href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Luckiest+Guy&family=Outfit:wght@600;700&family=Source+Sans+3:wght@500;600;700&family=Source+Serif+4:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="/styles/modals.css" />
    <link rel="stylesheet" href="/styles/lobby.css" />
    <link rel="stylesheet" href="/styles/game-board.css" />
    <link rel="stylesheet" href="/styles/common.css" />
    <link rel="stylesheet" href="/styles/manual-mode.css" />
    <link rel="stylesheet" href="/styles/tutorial.css" />

    <script type="module" src="/scripts/main.js"></script>

    <script>
      window.addEventListener('load', function () {
        setTimeout(function () {
          document.documentElement.classList.remove('preload');
          document.documentElement.classList.add('loaded');
        }, 50);
      });
    </script>

  </head>
  <body class="body-loading">
    <div class="modal__overlay modal__overlay--hidden" id="modal-overlay"></div>
    <div class="spectator-banner">Spectator Mode</div>

    <div class="game-viewport">
      <main class="main-content" id="main-content">
        <div class="lobby lobby--hidden" id="lobby-container">
        <div id="lobby-outer-card" class="lobby-modal-container">
          <div id="lobby-inner-content" class="game-setup-content">
              <details id="lobby-menu" class="lobby-menu">
                <summary class="lobby-menu__summary" aria-label="Lobby menu">
                  <span class="lobby-menu__icon" aria-hidden="true">
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M4 6H20M4 12H20M4 18H20"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                      />
                    </svg>
                  </span>
                  <span class="lobby-menu__label">MENU</span>
                </summary>
                <div class="lobby-menu__panel" role="menu">
                  <button
                    type="button"
                    id="lobby-feedback-btn"
                    class="lobby-menu__item"
                    role="menuitem"
                  >
                    <span class="lobby-menu__item-label">Feedback</span>
                  </button>
                  <button
                    id="setup-tutorial-button"
                    class="lobby-menu__item"
                    type="button"
                    role="menuitem"
                  >
                    <span class="lobby-menu__item-label">Tutorial</span>
                  </button>
                  <button
                    id="setup-rules-button"
                    class="lobby-menu__item"
                    type="button"
                    role="menuitem"
                  >
                    <span class="lobby-menu__item-label">Rules</span>
                  </button>
                </div>
              </details>
              <div class="setup-header">
                <div class="header-logo">
                  <img
                    id="site-logo"
                    src="/src/shared/logov2.svg"
                    alt="Top That! Logo"
                  />
                </div>
              </div>

              <form id="lobby-form" autocomplete="off">
                <div class="name-input-scroll-container">
                  <div class="parchment-scroll">
                    <label class="parchment-label" for="player-name-input"
                      >Who is playing today?</label
                    >
                    <input
                      type="text"
                      id="player-name-input"
                      class="parchment-input"
                      maxlength="20"
                      required
                    />
                  </div>
                </div>

                <details class="avatar-dropdown hidden" id="avatar-dropdown">
                  <summary
                    class="avatar-dropdown__summary"
                    style="display: none"
                  ></summary>
                  <div
                    class="avatar-dropdown__backdrop"
                    data-avatar-dropdown-close
                    aria-hidden="true"
                  ></div>
                  <div class="avatar-dropdown__panel">
                    <button
                      type="button"
                      class="avatar-dropdown__close"
                      aria-label="Close avatar picker"
                      data-avatar-dropdown-close
                    >
                      √ó
                    </button>
                    <div class="avatar-grid" id="avatar-grid"></div>
                  </div>
                </details>

                <div
                  class="lobby-tab-panel lobby-tab-panel--host is-active"
                  data-tab-panel="host"
                >
                  <div class="host-selection-rectangle">
                    <div class="player-selection player-selection--host">
                      <div class="player-section player-section--users">
                        <h3 class="section-title">PLAYERS</h3>
                        <div class="player-counter">
                          <button
                            type="button"
                            class="counter-btn"
                            id="humans-minus"
                          >
                            -
                          </button>
                          <input
                            type="number"
                            id="total-players-input"
                            min="1"
                            max="4"
                            value="1"
                            readonly
                          />
                          <button
                            type="button"
                            class="counter-btn"
                            id="humans-plus"
                          >
                            +
                          </button>
                        </div>
                        <div
                          class="player-silhouettes"
                          id="human-silhouettes"
                        ></div>
                      </div>

                      <div class="player-section player-section--bots">
                        <h3 class="section-title">BOTS</h3>
                        <div class="player-counter">
                          <button
                            type="button"
                            class="counter-btn"
                            id="cpus-minus"
                          >
                            -
                          </button>
                          <input
                            type="number"
                            id="cpu-players-input"
                            min="0"
                            value="1"
                            readonly
                          />
                          <button
                            type="button"
                            class="counter-btn"
                            id="cpus-plus"
                          >
                            +
                          </button>
                        </div>
                        <div
                          class="player-silhouettes"
                          id="cpu-silhouettes"
                        ></div>
                      </div>
                    </div>

                    <div class="lobby-actions">
                      <button
                        id="setup-deal-button"
                        class="lets-play-btn play-button-container"
                        type="button"
                        aria-label="Play"
                      >
                        <div class="deep-shadow" aria-hidden="true"></div>
                        <div class="pulsing-glow" aria-hidden="true"></div>
                        <div class="outer-gold-ring" aria-hidden="true">
                          <div class="button-base">
                            <div class="gloss-sweep"></div>
                            <div class="top-highlight"></div>
                            <div class="text-container">
                              <span class="text-shadow">PLAY</span>
                              <span class="text-main">PLAY</span>
                            </div>
                            <div class="bottom-shadow"></div>
                          </div>
                          </div>
                        </button>
                      <button
                        id="go-to-join-button"
                        class="lobby-tab-button lobby-nav-button"
                        type="button"
                        data-tab="join"
                      >
                        JOIN FRIEND
                      </button>
                    </div>
                  </div>
                </div>

                <div
                  class="lobby-tab-panel lobby-tab-panel--join"
                  data-tab-panel="join"
                >
                  <div class="host-selection-rectangle host-selection-rectangle--join">
                    <div class="player-section join-code-section">
                      <div class="join-avatar-container">
                        <div
                          id="join-player-avatar"
                          class="player-silhouette human is-avatar-picker"
                        >
                          <div class="emoji-avatar">?</div>
                        </div>
                      </div>

                      <div class="join-code-inputs">
                        <input
                          type="text"
                          id="join-code-input"
                          placeholder="ENTER GAME CODE"
                          maxlength="6"
                        />
                      </div>
                    </div>

                    <div class="lobby-actions lobby-actions--join">
                      <button
                        id="join-game-button"
                        type="button"
                        class="lets-play-btn play-button-container"
                        aria-label="Join game"
                      >
                        <div class="deep-shadow" aria-hidden="true"></div>
                        <div class="pulsing-glow" aria-hidden="true"></div>
                        <div class="outer-gold-ring" aria-hidden="true">
                          <div class="button-base">
                            <div class="gloss-sweep"></div>
                            <div class="top-highlight"></div>
                            <div class="text-container">
                              <span class="text-shadow">JOIN</span>
                              <span class="text-main">JOIN</span>
                            </div>
                            <div class="bottom-shadow"></div>
                          </div>
                        </div>
                      </button>

                      <button
                        id="go-to-host-button"
                        class="lobby-tab-button lobby-nav-button"
                        type="button"
                        data-tab="host"
                      >
                        HOST GAME
                      </button>
                    </div>
                  </div>
                </div>

                <div
                  class="lobby-tab-panel lobby-tab-panel--waiting"
                  data-tab-panel="waiting"
                  id="in-session-lobby-modal"
                  tabindex="-1"
                >
                  <div class="host-selection-rectangle host-selection-rectangle--join in-session-host-rectangle">
                    <div class="player-section waiting-code-section">
                      <h3 id="in-session-lobby-title" class="section-title">
                        WAITING FOR PLAYERS...
                      </h3>

                      <div class="name-input-section" id="guest-name-section">
                        <input
                          type="text"
                          id="guest-player-name-input"
                          placeholder="ENTER YOUR NAME"
                          maxlength="20"
                          required
                          autocomplete="off"
                        />
                      </div>

                      <div class="players-box">
                        <div
                          id="players-container"
                          class="players-container waiting-slots"
                        ></div>
                      </div>
                    </div>

                    <div class="lobby-actions lobby-actions--waiting">
                      <button
                        id="waiting-back-button"
                        class="lobby-tab-button lobby-nav-button waiting-back-btn"
                        type="button"
                        data-tab="join"
                      >
                        BACK
                      </button>
                      <button
                        id="ready-up-button"
                        class="lets-play-btn play-button-container"
                        type="button"
                        aria-label="Play"
                      >
                        <div class="deep-shadow" aria-hidden="true"></div>
                        <div class="pulsing-glow" aria-hidden="true"></div>
                        <div class="outer-gold-ring" aria-hidden="true">
                          <div class="button-base">
                            <div class="gloss-sweep"></div>
                            <div class="top-highlight"></div>
                        <div class="text-container">
                          <span class="text-shadow">PLAY</span>
                          <span class="text-main">PLAY</span>
                        </div>
                            <div class="bottom-shadow"></div>
                          </div>
                        </div>
                      </button>
                      <button
                        id="copy-link-button"
                        class="lobby-tab-button lobby-nav-button waiting-copy-btn"
                        type="button"
                        data-tab="host"
                      >
                        <span class="waiting-copy-label">COPY</span>
                        <span class="waiting-copy-code" id="waiting-room-code"
                          >------</span
                        >
                      </button>
                    </div>
                  </div>
                </div>

                <div
                  id="lobby-validation-message"
                  class="validation-message-container"
                >
                  <div class="message-box-content">
                    <p class="validation-text"></p>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div id="game-table" class="hidden table--hidden">
          <div class="table">
            <div class="game-menu-container">
              <button id="table-menu-button" aria-label="Menu">‚ò∞</button>
              <div id="game-menu-dropdown" class="game-menu-dropdown hidden">
                <button id="game-rules-button" class="menu-item">
                  üìú Rules
                </button>
                <button id="game-history-button" class="menu-item">
                  ‚è± Move History
                </button>
                <button
                  id="game-feedback-btn"
                  class="menu-item"
                >
                  üêû Feedback
                </button>
              </div>
            </div>

            <div class="table-slot-top" id="opponent-area-top"></div>
            <div class="table-slot-left" id="opponent-area-left"></div>
            <div class="table-center" id="center-area"></div>
            <div class="table-slot-right" id="opponent-area-right"></div>
            <div class="table-slot-bottom" id="player-area-bottom"></div>
          </div>
        </div>
      </main>
    </div>

    <div
      class="modal modal--hidden"
      id="rules-modal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="rules-modal-title"
    >
      <div class="lobby-modal-container">
        <div class="game-setup-content rules-modal-content">
          <button class="modal__close-button" aria-label="Close">
            &times;
          </button>
          <div class="rules-container">
            <h2 class="rules-title">THE OFFICIAL RULES</h2>
            <div class="button-container">
              <button id="expand-collapse-all-btn" class="btn expand-btn">
                Expand All
              </button>
            </div>
            <details class="rules-section">
              <summary class="rules-summary"><h3>Getting Started</h3></summary>
              <div class="rules-details-content">
                <ul>
                  <li>
                    <strong>Setup:</strong>
                    <span>Deal 9 cards per player:</span>
                    <ul>
                      <li>
                        3 Face-Down: Place in a row. (Do not look at these).
                      </li>
                      <li>3 Face-Up: Place on top of the face-down cards.</li>
                      <li>3 Hand Cards: Deal to your hand.</li>
                    </ul>
                  </li>
                  <li>
                    <strong>Start the game:</strong>
                    <ul>
                      <li>
                        Place the remaining deck in the center (draw pile).
                      </li>
                      <li>Flip the top card to start the play pile.</li>
                    </ul>
                  </li>
                </ul>
              </div>
            </details>
            <details class="rules-section">
              <summary class="rules-summary">
                <h3>Playing Your Turn</h3>
              </summary>
              <div class="rules-details-content">
                <ul>
                  <li>
                    <strong>Basic Actions:</strong>
                    <ul>
                      <li>
                        Play a card from your hand that is higher than the
                        current top card on the pile.
                      </li>
                      <li>
                        Multiples: You may play multiple copies of the same rank
                        (e.g., three Jacks).
                      </li>
                      <li>
                        Refill Hand: If the draw pile has cards, you must have 3
                        cards in your hand. If you have fewer than 3, draw until
                        you are back to 3.
                      </li>
                    </ul>
                  </li>
                  <li>
                    <strong>Card Progression:</strong>
                    <span
                      >You must clear your cards in this specific order:</span
                    >
                    <ul>
                      <li>
                        Hand Cards: Play these until the draw pile is gone and
                        your hand is empty.
                      </li>
                      <li>
                        Face-Up Cards: Unlocked only when your hand is empty.
                      </li>
                      <li>
                        Face-Down Cards: Unlocked only when all your face-up
                        cards are gone.
                      </li>
                    </ul>
                  </li>
                  <li>
                    <strong>Stuck?:</strong>
                    <ul>
                      <li>
                        If you cannot play a card (or beat the top card), you
                        must pick up the play pile.
                      </li>
                      <li>
                        If you pick up the pile while playing Face-Up or
                        Face-Down cards, you must clear your hand again before
                        you can go back to the table cards.
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            </details>
            <details class="rules-section">
              <summary class="rules-summary"><h3>Special Cards</h3></summary>
              <div class="rules-details-content">
                <p class="rules-lead">These cards break the standard rules.</p>
                <ul>
                  <li>
                    <strong>2 (Reset):</strong>
                    <ul>
                      <li>
                        Play on anything. It resets the pile's value to 2.
                      </li>
                    </ul>
                  </li>
                  <li>
                    <strong>5 (Copycat):</strong>
                    <ul>
                      <li>Becomes the value of the card below it.</li>
                    </ul>
                  </li>
                  <li>
                    <strong>10 (Burn):</strong>
                    <ul>
                      <li>
                        Explodes the pile. Remove the pile from the game. The
                        next player can play any card.
                      </li>
                    </ul>
                  </li>
                  <li>
                    <strong>4-of-a-Kind:</strong>
                    <ul>
                      <li>
                        If four of the same rank are played at a time (e.g.,
                        four 6s), the pile explodes just like a 10. The next
                        player can play any card.
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            </details>
            <details class="rules-section">
              <summary class="rules-summary"><h3>How to Win</h3></summary>
              <div class="rules-details-content">
                <ul>
                  <li>
                    <strong>Winning:</strong>
                    <ul>
                      <li>
                        The first player to play all of their cards wins the
                        game!
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            </details>
            <details class="rules-section" id="quick-tips-section">
              <summary class="rules-summary">
                <h3>Quick Tips & Strategy</h3>
              </summary>
              <div class="rules-details-content">
                <ul>
                  <li>
                    <strong>Save Special Cards:</strong>
                    <ul>
                      <li>
                        Hold onto 2s and 10s for when you're stuck with low
                        cards.
                      </li>
                    </ul>
                  </li>
                  <li>
                    <strong>Multiple Plays:</strong>
                    <ul>
                      <li>
                        When possible, play multiple cards of the same value to
                        reduce your hand size.
                      </li>
                    </ul>
                  </li>
                  <li>
                    <strong>Watch Opponents:</strong>
                    <ul>
                      <li>
                        Pay attention to which Face-Up cards others struggle to
                        play.
                      </li>
                    </ul>
                  </li>
                  <li>
                    <strong>Face-Down Risk:</strong>
                    <ul>
                      <li>
                        Face-Down cards are pure luck - get to them as quickly
                        as possible.
                      </li>
                    </ul>
                  </li>
                  <li>
                    <strong>Forced Pickup:</strong>
                    <ul>
                      <li>
                        Sometimes forcing an opponent to pick up a large pile is
                        the best strategy.
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            </details>
            <button class="btn rules-gotit-btn" id="rules-gotit-btn">
              Got it!
            </button>
          </div>
        </div>

      </div>
    </div>

    <div class="modal modal--hidden" id="feedback-modal" role="dialog">
      <div class="lobby-modal-container">
        <div class="game-setup-content">
          <button class="modal__close-button" id="close-feedback-btn">
            &times;
          </button>
          <h2 class="section-title">TELL THE DEV</h2>
          <form
            id="feedback-form"
            style="
              display: flex;
              flex-direction: column;
              gap: 15px;
              margin-top: 10px;
            "
          >
            <select
              id="feedback-type"
              style="
                padding: 12px;
                font-size: 1.1rem;
                border-radius: 8px;
                border: 2px solid #ccc;
              "
            >
              <option value="bug">üêõ Bug Report</option>
              <option value="feature">üí° Feature Idea</option>
              <option value="other">‚ù§Ô∏è General Feedback</option>
            </select>
            <textarea
              id="feedback-msg"
              rows="5"
              placeholder="What's on your mind?"
              style="
                padding: 12px;
                border-radius: 8px;
                border: 2px solid #ccc;
                font-size: 1rem;
              "
            ></textarea>
            <button
              type="submit"
              class="header-btn"
              style="
                background: linear-gradient(135deg, #ffc300 0%, #ffdb4d 100%);
                color: #1b2e3c;
                border: none;
              "
            >
              SEND FEEDBACK
            </button>
          </form>
        </div>
      </div>
    </div>

    <div id="toast-container" class="toast-container"></div>
  </body>
</html>
